<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="utf-8" />
  <title>41243166廖子科_網際網路HWK</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- A-Frame / plugins -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-environment-component@1.5.0/dist/aframe-environment-component.min.js"></script>
  <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
  <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
  <script src="./dist/aframe-troika-text.min.js"></script>

  <style>
    .rs-base .rs-container h1:not(:first-of-type),
    .rs-base .rs-container h1:not(:first-of-type)+.rs-group {
      display: none !important;
    }

    .rs-base .rs-container>.rs-group:first-of-type .rs-counter-base:first-of-type {
      display: none !important;
    }

    .rs-base {
      position: fixed !important;
      top: 8px;
      left: 8px;
      z-index: 99999;
      pointer-events: none;
      /* 不擋滑鼠互動 */
    }
  </style>
</head>

<body>
  <a-scene fog="color: #241417; near: 0; far: 5;" raycaster="far: 30; objects: .raycastable" cursor="rayOrigin: mouse"
    environment="preset: osiris" stats>
    <a-assets>
      <img id="thumbCastle" crossorigin="anonymous" src="https://raw.githubusercontent.com/LiaoZike/HomeWork-Aframe_asset/main/asset/NFU.png" />
      <img id="thumbSchool" crossorigin="anonymous" src="https://raw.githubusercontent.com/LiaoZike/HomeWork-Aframe_asset/main/asset/castle.png" />
      <img id="thumbEgypt" crossorigin="anonymous" src="https://raw.githubusercontent.com/LiaoZike/HomeWork-Aframe_asset/main/asset/3DVideo.jpg" />
    </a-assets>
    <!-- 標題說明 -->
    <a-entity position="0 4 -4"
      troika-text="value:四資工三甲-41243166-廖子科; fontSize:0.5; color:#FA0; anchor:center; baseline:center"
      material="side: double"></a-entity>
    <a-entity position="0 3 -4"
      troika-text="value:滑鼠選擇 1 個傳送門進入; fontSize:0.3; color:white; anchor:center; baseline:center"
      material="side: double"></a-entity>

    <!-- 三張卡片 -->
    <a-entity id="menu" position="0 1.6 -4">

      <!-- School -->
      <a-entity id="cardSchool" position="-3 0 0" look-at="[camera]" geometry="primitive: plane; width: 1.6; height: 2.2"
        material="color: #fff; shader: flat" class="raycastable" open-panel="target: #panelSchool"
        event-set__enter="_event: mouseenter; scale: 1.1 1.1 1" event-set__leave="_event: mouseleave; scale: 1 1 1">
        <a-entity geometry="primitive: plane; width: 1.5; height: 2" material="src: #thumbCastle; shader: flat"
          position="0 0 0.01" class="raycastable"></a-entity>
        <a-entity position="0 -1.2 0" troika-text="value:虎科第二校區+部分第三校區; fontSize:0.2; anchor:center; baseline:center"
          material="side: double"></a-entity>
      </a-entity>

      <!-- Castle -->
      <a-entity id="cardCastle" position="0 0 0" look-at="[camera]"
        geometry="primitive: plane; width: 1.6; height: 2.2" material="color: #fff; shader: flat" class="raycastable"
        open-panel="target: #panelCastle" event-set__enter="_event: mouseenter; scale: 1.1 1.1 1"
        event-set__leave="_event: mouseleave; scale: 1 1 1">
        <a-entity geometry="primitive: plane; width: 1.5; height: 2" material="src: #thumbSchool; shader: flat"
        position="0 0 0.01" class="raycastable"></a-entity>
        <a-entity position="0 -1.2 0" troika-text="value:城堡; fontSize:0.2; anchor:center; baseline:center"
          material="side: double"></a-entity>
      </a-entity>

      <!-- Video -->
      <a-entity id="cardVideo" position="3 0 0" look-at="[camera]" geometry="primitive: plane; width: 1.6; height: 2.2"
        material="color: #fff; shader: flat" class="raycastable" open-panel="target: #panelVideo"
        event-set__enter="_event: mouseenter; scale: 1.1 1.1 1" event-set__leave="_event: mouseleave; scale: 1 1 1">
        <a-entity geometry="primitive: plane; width: 1.5; height: 2" material="src: #thumbEgypt; shader: flat"
          position="0 0 0.01" class="raycastable"></a-entity>
        <a-entity position="0 -1.2 0" troika-text="value:3D 影片; fontSize:0.2; anchor:center; baseline:center"
          material="side: double"></a-entity>
      </a-entity>
    </a-entity>

    <!-- 面板  -->
    <a-mixin id="panelAnim" scale="0.001 0.001 0.001"
      animation__show="property: scale; to: 1 1 1; dur: 220; easing: easeOutCubic; startEvents: showPanel"
      animation__hide="property: scale; to: 0.001 0.001 0.001; dur: 200; easing: easeInCubic; startEvents: hidePanel"></a-mixin>

    <a-entity id="panelSchool" class="info-panel" position="0 1.6 -2.5" visible="false" look-at="[camera]"
      mixin="panelAnim">
      <a-plane width="3" height="2" color="#222" position="0 0 -0.01" material="opacity:0.9"></a-plane>
      <a-entity troika-text="value: 從網路上3D模型轉換成GTB; fontSize:0.22; color:#fff; maxWidth:2.7; anchor:left"
        position="-1.35 0.55 0.01"></a-entity>
       <a-entity geometry="primitive: plane; width: 1; height: 0.4" material="color:#444"
            position="-0.8 -0.6 0.01" class="raycastable" link="href: school.html">
        <a-plane width="1" height="0.4" color="#444"></a-plane>
        <a-entity troika-text="value: ⬆️前往; fontSize:0.2; color:#60a0ff" position="0 0 0.01"></a-entity>
      </a-entity>
       <a-entity geometry="primitive: plane; width: 1; height: 0.4" material="color:#444"
            position="0.8 -0.6 0.01" class="raycastable" close-panel="target: #panelSchool">
        <a-plane width="1" height="0.4" color="#444"></a-plane>
        <a-entity troika-text="value: ❌關閉; fontSize:0.2; color:#f33" position="0 0 0.01"></a-entity>
      </a-entity>
    </a-entity>

    <a-entity id="panelCastle" class="info-panel" position="0 1.6 -2.5" visible="false" look-at="[camera]"
      mixin="panelAnim">
      <a-plane width="3.1" height="2" color="#222" position="0 0 -0.01" material="opacity:0.9"></a-plane>
      <a-entity troika-text="value: 由基本幾何物件建構的城堡\n是否前往?; fontSize:0.22; color:#fff; maxWidth:2.7; anchor:left"
        position="-1.35 0.55 0.01"></a-entity>
       <a-entity geometry="primitive: plane; width: 1; height: 0.4" material="color:#444"
            position="-0.8 -0.6 0.01" class="raycastable" link="href: castle.html">
        <a-plane width="1" height="0.4" color="#444"></a-plane>
        <a-entity troika-text="value: ⬆️前往; fontSize:0.2; color:#60a0ff" position="0 0 0.01"></a-entity>
      </a-entity>
       <a-entity geometry="primitive: plane; width: 1; height: 0.4" material="color:#444"
            position="0.8 -0.6 0.01" class="raycastable" close-panel="target: #panelCastle">
        <a-plane width="1" height="0.4" color="#444"></a-plane>
        <a-entity troika-text="value: ❌關閉; fontSize:0.2; color:#f33" position="0 0 0.01"></a-entity>
      </a-entity>
    </a-entity>

    <a-entity id="panelVideo" class="info-panel" position="0 1.6 -2.5" visible="false" look-at="[camera]"
      mixin="panelAnim">
      <a-plane width="3.1" height="2" color="#222" position="0 0 -0.01" material="opacity:0.9"></a-plane>
      <a-entity troika-text="value: 將3D導入至Aframe\n是否前往觀看?\n(若進去後想離開請回上ㄧ頁); fontSize:0.22; color:#fff; maxWidth:2.7; anchor:left"
        position="-1.35 0.55 0.01"></a-entity>
       <a-entity geometry="primitive: plane; width: 1; height: 0.4" material="color:#444"
            position="-0.8 -0.6 0.01" class="raycastable" link="href: 3DVideo.html">
        <a-plane width="1" height="0.4" color="#444"></a-plane>
        <a-entity troika-text="value: ⬆️前往; fontSize:0.2; color:#60a0ff" position="0 0 0.01"></a-entity>
      </a-entity>
       <a-entity geometry="primitive: plane; width: 1; height: 0.4" material="color:#444"
            position="0.8 -0.6 0.01" class="raycastable" close-panel="target: #panelVideo">
        <a-plane width="1" height="0.4" color="#444"></a-plane>
        <a-entity troika-text="value: ❌關閉; fontSize:0.2; color:#f33" position="0 0 0.01"></a-entity>
      </a-entity>
    </a-entity>


    <!-- 燈光 -->
    <a-entity light="type: point; color:#f4f4f4; intensity:1.5; distance:12" position="0 4 4"></a-entity>
  </a-scene>
  <script>
    // 關閉面板：支援動畫
    AFRAME.registerComponent('close-panel', {
      schema: { target: { type: 'string' } }, // 改成字串 selector
      init() {
        this.el.addEventListener('click', (evt) => {
          evt.stopPropagation();
          const panel = this.el.sceneEl.querySelector(this.data.target);
          if (!panel) return;
          panel.emit('hidePanel');
          // 動畫結束後才隱藏
          setTimeout(() => panel.setAttribute('visible', 'false'), 220);
        });
      }
    });

    // 開啟面板：點擊時再查 DOM，避免初始化順序問題
    AFRAME.registerComponent('open-panel', {
      schema: { target: { type: 'string' } }, // 改成字串 selector
      init() {
        this.el.addEventListener('click', (evt) => {
          // 忽略在面板上的點擊
          if (evt.target && evt.target.closest && evt.target.closest('.info-panel')) return;

          const scene = this.el.sceneEl;
          const targetEl = scene.querySelector(this.data.target);
          if (!targetEl) return;

          // 關閉所有面板
          scene.querySelectorAll('.info-panel').forEach(p => {
            if (p.getAttribute('visible') === true) {
              p.emit('hidePanel');
              setTimeout(() => p.setAttribute('visible', 'false'), 220);
            } else {
              p.setAttribute('visible', 'false');
            }
          });

          // 顯示並播放彈出動畫
          targetEl.setAttribute('visible', 'true');
          targetEl.emit('showPanel');
        });
      }
    });
  </script>
</body>

</html>